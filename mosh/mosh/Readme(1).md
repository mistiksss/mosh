
# Школьная столовая

Веб-приложение для учёта питания в школьной столовой.
по банковской карте оплату

### Видеодемонстрация работы проекта: 

## Функционал

### Ученик
- Авторизация по email
- Онлайн-заказ питания с возможностью оплаты
- Система пополнения баланса
- Учёт аллергенов (будут видны тольо подходяие блюда)
- заказ со статусы их выполнения

### Повар
- Авторизация по email
- Выдача питания ученика
- Складской учёт
- Создание заявок на закупку продуктов
- Статистика выдачи питания за день

### Администратор
- Авторизация по email
- Просмотр статистики (выручка, посещаемость, расходы)
- Обработка заявок на закупку от поваров
- Формирование финансовых отчётов
- Управление пользователями системы

## Технологический стек
- **Backend:** Python 3.13, Flask
- **Database:** PostgreSQL
- **Frontend:** HTML/CSS/JavaScript (Vanilla)
- **Deployment:** Docker, Docker Compose

---

## Установка и запуск

Самый простой способ запустить проект — использовать Docker.

1. Склонируйте репозиторий на ваш компьютер или сервер:
   ```bash
   git clone <ссылка-на-репозиторий>
   cd school-canteen
   ```

2. Запустите контейнеры с помощью Docker Compose:
   ```bash
   docker-compose up -d --build
   ```

3. Инициализируйте базу данных (только при первом запуске):
   ```bash
   docker exec school_canteen_app python init_db.py
   ```

4. Приложение будет доступно по адресу: **http://localhost:5000**

---

## Тестовые данные для входа

При первом запуске создаются демонстрационные учётные записи. Пароль для всех пользователей: `1234`.

| Роль | Email             | Пароль         |
| :--- |:------------------|:---------------|
| **Администратор** | `admin@mail.ru`   | `pass123`      |
| **Повар** | `cook@mail.ru`    | `pass123` |
| **Ученик** | `student@mail.ru` | `pass123` |

### Тестовые данные для оплаты
Для проверки функционала оплаты используйте следующие тестовые данные:

- **Номер карты:** `2202 5117 1392 0393`
- **Срок действия:** `06/31`
- **CVC код:** `577`

---

## Принцип использования сайта

### Для ученика:
1. Войдите в систему под логином `Student`
2. Выбрать аллерген
3. Блюд содержащие аллергичесий продукт прпадут автоматически
4. Нажмите "Заказать" на выбранном блюде

### Для повара:
1. Войдите под логином `Cook`
2. В разделе "Склад" проверьте остатки продуктов
3. Можно подовать заявку на необходимые товары
5. В разделе выдача повар выдает блюда

### Для администратора:
1. Войдите под логином `Admin`
2. В разделе "Закупки" можно одобрить или отклнит закупку от повара
3. В разделе "Статистика" отслеживайте финансовые показатели и посещаемость

---

## Особенности реализации

### Безопасность
- Все пароли хранятся в виде криптостойких хешей
- Реализована ролевая модель доступа (RBAC)
- Защита от SQL-инъекций через использование ORM

### Платежная система
- Эмуляция банковских транзакций
- Валидация данных карт через алгоритм Луна
- Журналирование всех финансовых операций

### База данных
- Используется PostgreSQL с поддержкой транзакций
- Реализованы связи между таблицами для обеспечения целостности данных
- Автоматическое создание тестовых данных при инициализации

---

## Структура проекта

```
mosh/
├── app.py                 # Основной файл приложения Flask
├── requirements.txt       # Зависимости Python
├── Dockerfile            # Конфигурация Docker образа
├── docker-compose.yml    # Конфигурация Docker Compose
├── static/               # Статические файлы (CSS, JS, изображения)
│   ├── css/
│   │   ├── register.css
│   │   └── ...
│   └── js/
├── templates/            # HTML шаблоны
│   ├── login.html
│   ├── register.html
│   ├── main_student.html
│   ├── main_admin.html
│   ├── cook_dashboard.html
│   └── ...
└── database/            # Файлы базы данных (SQLite)
    └── school_canteen.db
```

---

## API эндпоинты

### Для учеников:
- `GET /api/dish/<id>` — получение информации о блюде
- `POST /api/buy/<id>` — покупка блюда
- `POST /api/topup` — пополнение баланса
- `POST /api/subscribe` — покупка подписки
- `POST /api/profile/allergens` — сохранение аллергенов

### Для поваров:
- `GET /api/cook/orders` — получение списка заказов
- `POST /api/cook/orders/issue` — выдача заказа
- `GET /api/cook/products` — получение информации о продуктах
- `POST /api/cook/requests/create` — создание заявки на закупку

### Для администраторов:
- `GET /api/admin/stats` — получение статистики
- `GET /api/admin/purchase_requests` — список заявок на закупку
- `POST /api/admin/purchase_requests/<id>/decision` — обработка заявки

---

## Разработка

### Локальная разработка (без Docker)
1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

2. Создайте файл `.env` с переменными окружения:
   ```
   FLASK_SECRET_KEY=ваш_секретный_ключ
   DATABASE_URL=postgresql://user:password@localhost/school_canteen
   ```

3. Инициализируйте базу данных:
   ```bash
   python init_db.py
   ```

4. Запустите приложение:
   ```bash
   python app.py
   ```